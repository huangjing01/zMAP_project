!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cytoscapeLayoutUtilities=t():e.cytoscapeLayoutUtilities=t()}(this,function(){return function(e){function t(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,o){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,i){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n={},r=i(1);n.uniqueArray=function(e){var t={};return e.forEach(function(e){t[e+"::"+(void 0===e?"undefined":o(e))]=e}),Object.keys(t).map(function(e){return t[e]})},n.LineSuperCover=function(e,t){for(var i=t.x-e.x,o=t.y-e.y,n=Math.floor(Math.abs(i)),s=Math.floor(Math.abs(o)),c=i>0?1:-1,h=o>0?1:-1,a=new r.Point(e.x,e.y),d=[new r.Point(a.x,a.y)],u=0,f=0;u<n||f<s;)(.5+u)/n==(.5+f)/s?(a.x+=c,a.y+=h,u++,f++):(.5+u)/n<(.5+f)/s?(a.x+=c,u++):(a.y+=h,f++),d.push(new r.Point(a.x,a.y));return d},e.exports=n},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),r=(i(0),function e(t,i,n,r,c){o(this,e),this.grid=new Array(t);for(var h=0;h<t;h++){this.grid[h]=new Array(i);for(var a=0;a<i;a++)this.grid[h][a]=!1}this.index=n,this.leftMostCoord=r,this.topMostCoord=c,this.width=t,this.height=i,this.location=new s(-1,-1),this.center=new s(Math.floor(t/2),Math.floor(i/2)),this.numberOfOccupiredCells=0}),s=function e(t,i){o(this,e),this.x=t,this.y=i},c=function e(t,i,n,r){o(this,e),this.x1=t,this.x2=n,this.y1=i,this.y2=r},h=function e(t,i){o(this,e),this.occupied=t,this.visited=i},a=function(){function e(t,i){o(this,e),this.width=t,this.height=i,this.grid=new Array(t);for(var n=0;n<t;n++){this.grid[n]=new Array(i);for(var r=0;r<i;r++)this.grid[n][r]=new h(!1,!1)}this.center=new s(Math.floor(t/2),Math.floor(i/2)),this.occupiedRectangle=new c(0,0,0,0),this.numberOfOccupiredCells=0}return n(e,[{key:"getDirectNeighbors",value:function(e,t){var i=[];if(0==e.length){for(var o=0;o<this.width;o++)for(var n=0;n<this.height;n++)this.grid[o][n].occupied&&(i=i.concat(this.getCellNeighbors(o,n)));for(var r=0,s=i.length-1,o=2;o<=t;o++){if(s>=r)for(var n=r;n<=s;n++)i=i.concat(this.getCellNeighbors(i[n].x,i[n].y));r=s+1,s=i.length-1}}else e.forEach(function(e){i=i.concat(this.getCellNeighbors(e.x,e.y))}.bind(this));return i}},{key:"getCellNeighbors",value:function(e,t){var i=[];return e-1>=0&&(this.grid[e-1][t].occupied||this.grid[e-1][t].visited||(i.push({x:e-1,y:t}),this.grid[e-1][t].visited=!0)),e+1<this.width&&(this.grid[e+1][t].occupied||this.grid[e+1][t].visited||(i.push({x:e+1,y:t}),this.grid[e+1][t].visited=!0)),t-1>=0&&(this.grid[e][t-1].occupied||this.grid[e][t-1].visited||(i.push({x:e,y:t-1}),this.grid[e][t-1].visited=!0)),t+1<this.height&&(this.grid[e][t+1].occupied||this.grid[e][t+1].visited||(i.push({x:e,y:t+1}),this.grid[e][t+1].visited=!0)),e-1>=0&&(this.grid[e-1][t].occupied||this.grid[e-1][t].visited||(i.push({x:e-1,y:t}),this.grid[e-1][t].visited=!0)),e-1>=0&&t-1>=0&&(this.grid[e-1][t-1].occupied||this.grid[e-1][t-1].visited||(i.push({x:e-1,y:t-1}),this.grid[e-1][t-1].visited=!0)),e+1<this.width&&t-1>=0&&(this.grid[e+1][t-1].occupied||this.grid[e+1][t-1].visited||(i.push({x:e+1,y:t-1}),this.grid[e+1][t-1].visited=!0)),e-1>=0&&t+1<this.height&&(this.grid[e-1][t+1].occupied||this.grid[e-1][t+1].visited||(i.push({x:e-1,y:t+1}),this.grid[e-1][t+1].visited=!0)),e+1<this.width&&t+1<this.height&&(this.grid[e+1][t+1].occupied||this.grid[e+1][t+1].visited||(i.push({x:e+1,y:t+1}),this.grid[e+1][t+1].visited=!0)),i}},{key:"placePolyomino",value:function(e,t,i){e.location.x=t,e.location.y=i;for(var o=0;o<e.width;o++)for(var n=0;n<e.height;n++)e.grid[o][n]&&(this.grid[o-e.center.x+t][n-e.center.y+i].occupied=!0);this.numberOfOccupiredCells+=e.numberOfOccupiredCells;for(var r=1e4,s=0,c=1e4,h=0,a=0;a<this.width;a++)for(var d=0;d<this.height;d++)this.grid[a][d].visited=!1,this.grid[a][d].occupied&&(a<=r&&(r=a),d<=c&&(c=d),a>=s&&(s=a),d>=h&&(h=d));this.occupiedRectangle.x1=r,this.occupiedRectangle.y1=c,this.occupiedRectangle.x2=s,this.occupiedRectangle.y2=h}},{key:"tryPlacingPolyomino",value:function(e,t,i){for(var o=0;o<e.width;o++)for(var n=0;n<e.height;n++){if(o-e.center.x+t>=this.width||o-e.center.x+t<0||n-e.center.y+i>=this.height||n-e.center.y+i<0)return!1;if(e.grid[o][n]&&this.grid[o-e.center.x+t][n-e.center.y+i].occupied)return!1}return!0}},{key:"calculateUtilityOfPlacing",value:function(e,t,i,o){var n={},r=1,s=1,c=1,h=this.occupiedRectangle.x1,a=this.occupiedRectangle.x2,d=this.occupiedRectangle.y1,u=this.occupiedRectangle.y2;t-e.center.x<h&&(h=t-e.center.x),i-e.center.y<d&&(d=i-e.center.y),e.width-1-e.center.x+t>a&&(a=e.width-1-e.center.x+t),e.height-1-e.center.y+i>u&&(u=e.height-1-e.center.y+i);var f=a-h+1,l=u-d+1;return r=f/l,s=(this.numberOfOccupiredCells+e.numberOfOccupiredCells)/(f*l),c=r>o?(this.numberOfOccupiredCells+e.numberOfOccupiredCells)/(f*(f/o)):(this.numberOfOccupiredCells+e.numberOfOccupiredCells)/(l*o*l),n.actualAspectRatio=r,n.fullness=s,n.adjustedFullness=c,n}}]),e}();e.exports={Grid:a,Polyomino:r,BoundingRectangle:c,Point:s}},function(e,t,i){"use strict";var o=i(0),n=i(1),r=function(e,t){var i={};return i.placeHiddenNodes=function(e){e.forEach(function(e){e.neighborhood().nodes(":hidden").forEach(function(t){t.neighborhood().nodes(":visible").length>1?i.nodeWithMultipleNeighbors(t):i.nodeWithOneNeighbor(e,t)})})},i.placeNewNodes=function(e){for(var o=this.findComponents(e),n=[],r=0;r<o.length;r++){for(var s,c=!1,h=!1,a=[],d=[],u=0,f=0,l=!1,p=0;p<o[r].length;p++){var g=o[r][p].neighborhood().nodes().difference(e);d.push(!1),g.length>1&&!l?(h=!0,d[p]=!0,a=g,i.nodeWithMultipleNeighbors(o[r][p],a),u=o[r][p].position("x"),f=o[r][p].position("y"),l=!0):1!=g.length||l||(c=!0,s=g[0],d[p]=!0,i.nodeWithOneNeighbor(s,o[r][p]),u=o[r][p].position("x"),f=o[r][p].position("y"),l=!0)}if(c||h){for(var p=0;p<o[r].length;p++)if(0==d[p]){var g=o[r][p].neighborhood().nodes(),y=[],v=o[r][p].neighborhood().nodes().difference(e);v.forEach(function(e){y.push(e)});for(var x=0;x<g.length;x++)d[o[r].indexOf(g[x])]&&y.push(g[x]);if(y.length>1)i.nodeWithMultipleNeighbors(o[r][p],y);else if(1==y.length)i.nodeWithOneNeighbor(y[0],o[r][p]);else{var b=i.generateRandom(t.offset,2*t.offset,0),m=i.generateRandom(t.offset,2*t.offset,0);o[r][p].position("x",u+b),o[r][p].position("y",f+m)}d[p]=!0}}else n.push(o[r])}n.length>=1&&i.disconnectedNodes(n)},i.disconnectedNodes=function(o){var n=Number.MAX_VALUE,r=Number.MIN_VALUE,s=Number.MAX_VALUE,c=Number.MIN_VALUE;e.nodes(":visible").forEach(function(e){var t=e.outerWidth()/2,i=e.outerHeight()/2;e.position("x")-t<n&&(n=e.position("x")-t),e.position("x")+t>r&&(r=e.position("x")+t),e.position("y")-i<s&&(s=e.position("y")-i),e.position("y")+i>c&&(c=e.position("y")+i)});var h=s-c,a=r-n,d=Math.sqrt(a*a+h*h)/2,u=(n+r)/2,f=(s+c)/2,l=o.length,p=360/l,g=1;o.forEach(function(e){var o=i.generateRandom(d+6*t.offset,d+8*t.offset,1),n=p*g,r=n*Math.PI/180,s=u+o*Math.cos(r),c=f+o*Math.sin(r);if(1==e.length)e[0].position("x",s),e[0].position("y",c);else{for(var h=[],a=0;a<e.length;a++)h.push(!1);h[0]=!0,e[0].position("x",s),e[0].position("y",c);for(var a=1;a<e.length;a++){for(var l=e[a].neighborhood().nodes(),y=[],v=0;v<l.length;v++)h[e.indexOf(l[v])]&&y.push(l[v]);if(y.length>1)i.nodeWithMultipleNeighbors(e[a],y);else if(1==y.length)i.nodeWithOneNeighbor(y[0],e[a]);else{var x=i.generateRandom(t.offset,2*t.offset,0),b=i.generateRandom(t.offset,2*t.offset,0);e[a].position("x",s+x),e[a].position("y",c+b)}h[a]=!0}}g++})},i.findComponents=function(t){var i=[],o=e.nodes().difference(t);t.forEach(function(e){var n=e.neighborhood().nodes().difference(o),r=[];n.forEach(function(e){var i=t.indexOf(e);r.push(i)}),i.push(r)});for(var n=[],r=0;r<t.length;r++)n.push(!1);for(var s=[],r=0;r<t.length;r++){var c=[];0==n[r]&&(this.DFSUtil(r,n,i,t,c),s.push(c))}return s},i.DFSUtil=function(e,t,i,o,n){t[e]=!0,n.push(o[e]);for(var r=0;r<i[e].length;r++)t[i[e][r]]||this.DFSUtil(i[e][r],t,i,o,n)},i.nodeWithOneNeighbor=function(e,o){var n=i.checkOccupiedQuadrants(e,o),r=[];for(var s in n)"free"===n[s]&&r.push(s);var c,h;if(r.length>0)if(3===r.length)r.includes("first")&&r.includes("second")&&r.includes("third")?(c=-1,h=-1):r.includes("first")&&r.includes("second")&&r.includes("fourth")?(c=1,h=-1):r.includes("first")&&r.includes("third")&&r.includes("fourth")?(c=1,h=1):r.includes("second")&&r.includes("third")&&r.includes("fourth")&&(c=-1,h=1);else{var a=r[Math.floor(Math.random()*r.length)];"first"===a?(c=1,h=-1):"second"===a?(c=-1,h=-1):"third"===a?(c=-1,h=1):"fourth"===a&&(c=1,h=1)}else c=0,h=0;var d=i.generateRandom(t.idealEdgeLength-t.offset,t.idealEdgeLength+t.offset,c),u=i.generateRandom(t.idealEdgeLength-t.offset,t.idealEdgeLength+t.offset,h),f=e.position("x")+d,l=e.position("y")+u;o.position("x",f),o.position("y",l)},i.nodeWithMultipleNeighbors=function(e,o){if(null==o)var o=e.neighborhood().nodes(":visible");var n=0,r=0,s=0;o.forEach(function(e){n+=e.position("x"),r+=e.position("y"),s++}),n/=s,r/=s;var c=i.generateRandom(0,t.offset/2,0),h=i.generateRandom(0,t.offset/2,0);e.position("x",n+c),e.position("y",r+h)},i.generateRandom=function(e,t,i){var o=[-1,1];return 0===i&&(i=o[Math.floor(Math.random()*o.length)]),(Math.floor(Math.random()*(t-e+1))+e)*i},i.checkOccupiedQuadrants=function(e,t){var i=e.neighborhood().difference(t).nodes(),o={first:"free",second:"free",third:"free",fourth:"free"};return i.forEach(function(t){"compartment"!=t.data("class")&&"complex"!=t.data("class")&&(t.position("x")<e.position("x")&&t.position("y")<e.position("y")?o.second="occupied":t.position("x")>e.position("x")&&t.position("y")<e.position("y")?o.first="occupied":t.position("x")<e.position("x")&&t.position("y")>e.position("y")?o.third="occupied":t.position("x")>e.position("x")&&t.position("y")>e.position("y")&&(o.fourth="occupied"))}),o},i.packComponents=function(e){var i=0,r=0;if(e.forEach(function(e){r+=e.nodes.length,e.nodes.forEach(function(e){i+=e.width+e.height})}),i/=2*r,i=Math.floor(i*t.polyominoGridSizeFactor),t.componentSpacing>0){var s=t.componentSpacing;e.forEach(function(e){e.nodes.forEach(function(e){e.x=e.x-s,e.y=e.y-s,e.width=e.width+2*s,e.height=e.height+2*s})})}var c=0,h=0,a=[],d=1e4,u=0,f=1e4,l=0;e.forEach(function(e,t){var r=1e4,s=0,p=1e4,g=0;e.nodes.forEach(function(e){e.x<=r&&(r=e.x),e.y<=p&&(p=e.y),e.x+e.width>=s&&(s=e.x+e.width),e.y+e.height>=g&&(g=e.y+e.height)}),e.edges.forEach(function(e){e.startX<=r&&(r=e.startX),e.startY<=p&&(p=e.startY),e.endX>=s&&(s=e.endX),e.endY>=g&&(g=e.endY)}),r<d&&(d=r),s>u&&(u=s),p<f&&(f=p),g>l&&(l=g),c+=s-r,h+=g-p;var y=Math.floor((s-r)/i)+1,v=Math.floor((g-p)/i)+1,x=new n.Polyomino(y,v,t,r,p);e.nodes.forEach(function(e){for(var t=Math.floor((e.x-r)/i),o=Math.floor((e.y-p)/i),n=Math.floor((e.x+e.width-r)/i),s=Math.floor((e.y+e.height-p)/i),c=t;c<=n;c++)for(var h=o;h<=s;h++)x.grid[c][h]=!0}),e.edges.forEach(function(e){var t={},n={};t.x=(e.startX-r)/i,t.y=(e.startY-p)/i,n.x=(e.endX-r)/i,n.y=(e.endY-p)/i,o.LineSuperCover(t,n).forEach(function(e){var t=Math.floor(e.x),i=Math.floor(e.y);t>=0&&t<x.width&&i>=0&&i<x.height&&(x.grid[Math.floor(e.x)][Math.floor(e.y)]=!0)})});for(var b=0;b<x.width;b++)for(var m=0;m<x.height;m++)x.grid[b][m]&&x.numberOfOccupiredCells++;a.push(x)});var p=new n.Point((d+u)/2,(f+l)/2);new n.Point(Math.floor(p.x/i),Math.floor(p.y/i));a.sort(function(e,t){var i=e.width*e.height,o=t.width*t.height;return i>o?-1:i<o?1:0}),c=Math.ceil(2*c/i),h=Math.ceil(2*h/i);var g=new n.Grid(c+1,h+1);g.placePolyomino(a[0],g.center.x,g.center.y);for(var y=1;y<a.length;y++){for(var v=0,x=0,b=0,m=1e6,M=!1,R=[],w={};!M;)R=g.getDirectNeighbors(R,Math.ceil(Math.max(a[y].width,a[y].height)/2)),R.forEach(function(e){if(g.tryPlacingPolyomino(a[y],e.x,e.y)){M=!0;var i=g.calculateUtilityOfPlacing(a[y],e.x,e.y,t.desiredAspectRatio),o=!1;if(1==t.utilityFunction)i.adjustedFullness>x?o=!0:i.adjustedFullness==x&&(i.fullness>v?o=!0:i.fullness==v&&Math.abs(i.actualAspectRatio-t.desiredAspectRatio)<=m&&(o=!0)),o&&(x=i.adjustedFullness,m=Math.abs(i.actualAspectRatio-t.desiredAspectRatio),v=i.fullness,w.x=e.x,w.y=e.y);else if(2==t.utilityFunction){var n=Math.abs(i.actualAspectRatio-t.desiredAspectRatio),r=.5*i.fullness+(1-n/Math.max(i.actualAspectRatio,t.desiredAspectRatio)*.5);r>b&&(b=r,w.x=e.x,w.y=e.y)}}});g.placePolyomino(a[y],w.x,w.y)}a.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0});var O={};if(O.shifts=[],a.forEach(function(e){var t=(e.location.x-e.center.x-g.occupiedRectangle.x1)*i-e.leftMostCoord,o=(e.location.y-e.center.y-g.occupiedRectangle.y1)*i-e.topMostCoord;O.shifts.push({dx:t,dy:o})}),O.aspectRatio=Math.round((g.occupiedRectangle.x2-g.occupiedRectangle.x1+1)/(g.occupiedRectangle.y2-g.occupiedRectangle.y1+1)*100)/100,O.fullness=Math.round(g.numberOfOccupiredCells/((g.occupiedRectangle.x2-g.occupiedRectangle.x1+1)*(g.occupiedRectangle.y2-g.occupiedRectangle.y1+1))*100*100)/100,O.aspectRatio>t.desiredAspectRatio){var E=g.occupiedRectangle.x2-g.occupiedRectangle.x1+1;O.adjustedFullness=Math.round(g.numberOfOccupiredCells/(E*(E/t.desiredAspectRatio))*100*100)/100}else{var C=g.occupiedRectangle.y2-g.occupiedRectangle.y1+1;O.adjustedFullness=Math.round(g.numberOfOccupiredCells/(C*t.desiredAspectRatio*C)*100*100)/100}return O},i};e.exports=r},function(e,t,i){"use strict";var o,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var r=function(e){if(e){var t={idealEdgeLength:50,offset:20,desiredAspectRatio:1,polyominoGridSizeFactor:1,utilityFunction:1,componentSpacing:30},o=i(2);e("core","layoutUtilities",function(e){function i(e){e=e||{};for(var t=1;t<arguments.length;t++){var o=arguments[t];if(o)for(var r in o)o.hasOwnProperty(r)&&(Array.isArray(o[r])?e[r]=o[r].slice():"object"===n(o[r])?e[r]=i(e[r],o[r]):e[r]=o[r])}return e}function r(e){return e.scratch("_layoutUtilities")||e.scratch("_layoutUtilities",{}),e.scratch("_layoutUtilities")}var s=this;if("get"===e)return r(s).instance;t=i({},t,e);var c=o(s,t);if(r(s).instance=c,!r(s).initialized){r(s).initialized=!0;var h=!1;document.addEventListener("keydown",function(e){"Shift"==e.key&&(h=!0)}),document.addEventListener("keyup",function(e){"Shift"==e.key&&(h=!1)})}return r(s).instance})}};void 0!==e&&e.exports&&(e.exports=r),void 0!==(o=function(){return r}.call(t,i,t,e))&&(e.exports=o),"undefined"!=typeof cytoscape&&r(cytoscape)}()}])});